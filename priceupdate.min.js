"use strict";var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(function(){var a=function(){function c(d){_classCallCheck(this,c),this.id=Math.random(),this.parent,this.$element,this.operator,this.price,this.calctype,this._init(d)}return _createClass(c,[{key:"_init",value:function(e){var f=this;this.parent=e.parent,this.$element=e.$element,this.$element?(this.name=this.$element.attr("name"),this.type=this.$element.attr("type")||this.$element[0].nodeName.toLowerCase(),this.operator=this.$element.attr("data-price-operator")||"+",this.calctype=this.$element.attr("data-price-calctype")||"update",this.price=function(){var g=f.$element.attr("data-price-value");return g?parseFloat(g):0}(),this._checkChoosen(this.type),this.$element.on("change",function(){"select"==f.type&&f._getSelectData(),f.parent.recalc(f)})):console.error("calcPrice target option reference to undefined element")}},{key:"_checkChoosen",value:function(e){"select"==e?(this._getSelectData(),this.price&&this.parent.recalc(this)):("radio"==this||"checkbox"==e)&&this.$element.attr("checked")&&this.parent.recalc(this)}},{key:"_getSelectData",value:function(){var e=this.$element.find("option:selected");this.operator=e.attr("data-price-operator"),this.price=function(){var f=e.attr("data-price-value");return f?parseFloat(f):0}()}}]),c}(),b=function(){function c(d){_classCallCheck(this,c),this.$element,this.price,this.currency,this.updatePrice,this.points,this.old,this.oldPrice,this.options={},this.factor,this._init(d)}return _createClass(c,[{key:"_init",value:function(e){var f=this;this.$element=e.$element,this.$element?(this.price=parseFloat(this.$element.attr("data-price-value"))||0,this.currency=this.$element.attr("data-price-currency")||"",this.old=function(){var g=f.$element.attr("data-price-old");return g=!!g&&$(g),!!g&&g}(),this.oldPrice=f.old?parseFloat(f.old.attr("data-price-value"))||0:0,this.factor=function(){return f.old?f.oldPrice/f.price:0}(),this.points=function(){var g=[],h=f.$element.attr("data-price-points")||!1;return!h||(h=$("[data-price-target='"+h+"']")),h&&h.each(function(){var k=new a({$element:$(this),parent:f});g.push(k)}),g}()):console.error("calcPrice must have some elements for init")}},{key:"recalc",value:function(e){this._addToList(e);var f=this.price,g=0;for(var h in this.options){var e=this.options[h];switch(e.operator){case"+":g+=e.price;break;case"-":g-=e.price;break;case"*":"update"==e.calctype?f*=e.price:"static"==e.calctype&&(f=0,g+=this.price*e.price);break;case"/":"update"==e.calctype?f/=e.price:"static"==e.calctype&&(f=0,g+=this.price/e.price);break;case"+%":"update"==e.calctype?g+=f/100*e.price:"static"==e.calctype&&(g+=this.price/100*e.price),console.log(g);break;case"-%":"update"==e.calctype?g-=f/100*e.price:"static"==e.calctype&&(g-=this.price/100*e.price);}}f+=g,this.updatePrice=f,this._insertPrice(f),this.old&&this.old.text(Math.round(this.factor*this.updatePrice)+this.currency)}},{key:"_addToList",value:function(e){function f(h){for(var j in g.options)g.options[j].type==h.type&&g.options[j].name==h.name&&delete g.options[j]}var g=this;"radio"==e.type?e.price?(f(e),!(e.id in this.options)&&(this.options[e.id]=e)):f(e):"checkbox"==e.type?e.id in this.options?delete this.options[e.id]:this.options[e.id]=e:"select"==e.type&&(e.id in this.options?e.price?this.options[e.id]=e:delete this.options[e.id]:this.options[e.id]=e)}},{key:"_insertPrice",value:function(e){this.$element.val(e+this.currency),this.$element.text(e+this.currency)}}]),c}();$.fn.priceupdate=function(c){this.each(function(){c?c.$element=$(this):c={$element:$(this)},this.price=new b(c)})},$(document).ready(function(){$(".priceupdate").priceupdate()})})();